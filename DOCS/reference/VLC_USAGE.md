# Использование VLC в проекте

Руководство по параметрам запуска VLC и настройкам Dialog-меню для проекта VLC Media Player.

---

## Запуск VLC через vlc-cec.sh

###  Базовый запуск

```bash
./vlc-cec.sh "/path/to/video.mkv"
```

Запускает VLC с начала файла.

### Запуск с сохранённой позиции

```bash
./vlc-cec.sh "1234" "/path/to/video.mkv"
```

- **Первый параметр:** позиция в секундах (1234)
- **Второй параметр:** путь к файлу

VLC начнёт воспроизведение с указанной позиции.

---

## Dialog меню (video-menu.sh)

### Параметры запуска

```bash
dialog --colors --output-fd 1 \
    --title "$title" \
    --default-item "$default_item" \
    --menu "Выберите файл или папку:" 20 120 15 \
    "${items[@]}" \
    2>/dev/tty
```

**Параметры:**
- `--colors` - поддержка цветов
- `--output-fd 1` - вывод в stdout
- `--title` - заголовок окна
- `--default-item` - элемент по умолчанию (курсор)
- `--menu` - тип меню
- `20 120 15` - высота, ширина, кол-во видимых элементов

### Структура items

```bash
items=(
    "video.mkv" "[X] video.mkv  8.5G"
    "folder/"   "[DIR] folder/"
)
```

**Формат:**
- **Tag** (первое поле) = чистое имя → hotkey на первой букве
- **Description** (второе поле) = иконка статуса + размер

### Цветовые коды Dialog

```
\Z4 - синий (не используется в текущей версии)
\Z1 - красный (автоматически для первой буквы hotkey)
\Zn - сброс цвета
```

> [!NOTE]
> Dialog автоматически подсвечивает первый символ tag красным как hotkey.  
> Попытки добавить цвета вручную через `\Z` не работают корректно.

---

## Пороги процентов просмотра

Определяют иконки статуса в меню:

```bash
WATCHED_THRESHOLD=99     # >= 99% = [X] просмотрено
PARTIAL_THRESHOLD=1      # >=  1% = [T] частично просмотрено
                         #     0% = [ ] не смотрели
```

**Примеры:**
- 0% → `[ ]` не смотрели
- 5% → `[T]` частично
- 100% → `[X]` просмотрено

---

## Параметры VLC

### RC интерфейс

VLC запускается с интерфейсом удалённого управления:

```bash
cvlc --intf rc --rc-host localhost:4212 "$video_file"
```

- `--intf rc` - интерфейс remote control
- `--rc-host localhost:4212` - сетевой адрес для команд

### Основные RC команды

```bash
# Получить текущую позицию (секунды)
echo "get_time" | nc localhost 4212

# Получить длительность (секунды)
echo "get_length" | nc localhost 4212

# Перейти к позиции
echo "seek 1234" | nc localhost 4212

# Пауза/продолжение
echo "pause" | nc localhost 4212

# Выход
echo "quit" | nc localhost 4212
```

---

## Автосохранение прогресса

Прогресс сохраняется автоматически:

**Интервал:** Каждые 60 секунд во время воспроизведения  
**Финальное сохранение:** При выходе (BACK, Ctrl-C, завершение файла)  
**Библиотека:** `playback-tracker.sh`

---

**Версия документа:** 1.0  
**Последнее обновление:** 01.12.2025
