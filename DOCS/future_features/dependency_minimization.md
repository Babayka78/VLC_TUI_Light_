# Минимизация зависимостей проекта

**Дата создания:** 15.12.2025  
**Приоритет:** Средний  
**Статус:** Планирование

---

## Проблема

Текущий проект зависит от внешних пакетов, которые должны быть установлены в системе:
- **VLC** - медиаплеер
- **SQLite3** - база данных
- **Dialog** - TUI интерфейс
- **bc** - калькулятор (опционально)

Это создаёт проблемы:
- Необходимость установки на каждой новой системе
- Различия версий между ОС
- Потенциальные проблемы совместимости

---

## Цель

Создать **portable** версию проекта, которая включает все необходимые компоненты и работает "из коробки" на любой ОС.

---

## Возможные подходы

### 1. Статическая компиляция

**Идея:** Скомпилировать зависимости статически и включить в проект.

**Плюсы:**
- ✅ Полная независимость от системных пакетов
- ✅ Гарантированная совместимость версий

**Минусы:**
- ❌ Сложность компиляции для разных архитектур (ARM, x86_64)
- ❌ Большой размер итогового пакета
- ❌ Лицензионные ограничения (VLC - GPL)

---

### 2. Portable бинарники

**Идея:** Включить предкомпилированные бинарники для каждой платформы.

**Структура:**
```
vlc/
├── bin/
│   ├── macos/
│   │   ├── vlc
│   │   ├── sqlite3
│   │   └── dialog
│   ├── linux-arm/
│   │   ├── vlc
│   │   ├── sqlite3
│   │   └── dialog
│   └── linux-x86_64/
│       ├── vlc
│       ├── sqlite3
│       └── dialog
└── scripts/
    └── detect_platform.sh
```

**Плюсы:**
- ✅ Относительно простая реализация
- ✅ Работает "из коробки"

**Минусы:**
- ❌ Большой размер репозитория
- ❌ Необходимость обновления бинарников
- ❌ Лицензионные вопросы

---

### 3. Docker контейнер

**Идея:** Упаковать всё в Docker образ.

**Плюсы:**
- ✅ Полная изоляция
- ✅ Гарантированная воспроизводимость

**Минусы:**
- ❌ Требует Docker на целевой системе
- ❌ Сложности с GUI (VLC)
- ❌ Оверхед производительности

---

### 4. AppImage / DMG Bundle

**Идея:** Создать самодостаточный пакет для каждой ОС.

**macOS:** DMG bundle с включёнными зависимостями  
**Linux:** AppImage с портативными библиотеками

**Плюсы:**
- ✅ Нативный подход для каждой ОС
- ✅ Удобство установки

**Минусы:**
- ❌ Необходимость поддержки двух форматов
- ❌ Сложность сборки

---

### 5. Проверка и автоустановка зависимостей

**Идея:** Скрипт проверяет наличие зависимостей и предлагает установить.

```bash
#!/bin/bash
# check_dependencies.sh

check_and_install() {
    local cmd="$1"
    local install_cmd="$2"
    
    if ! command -v "$cmd" &>/dev/null; then
        echo "❌ $cmd не найден"
        echo "Установить? (y/n)"
        read -r answer
        if [ "$answer" = "y" ]; then
            eval "$install_cmd"
        fi
    else
        echo "✅ $cmd установлен"
    fi
}

# macOS
if [[ "$OSTYPE" == "darwin"* ]]; then
    check_and_install "vlc" "brew install --cask vlc"
    check_and_install "dialog" "brew install dialog"
    check_and_install "sqlite3" "brew install sqlite"
fi

# Debian/Ubuntu
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    check_and_install "vlc" "sudo apt-get install vlc"
    check_and_install "dialog" "sudo apt-get install dialog"
    check_and_install "sqlite3" "sudo apt-get install sqlite3"
fi
```

**Плюсы:**
- ✅ Простота реализации
- ✅ Не увеличивает размер проекта

**Минусы:**
- ❌ Требует права администратора
- ❌ Зависимость от пакетных менеджеров

---

## Рекомендация

**Краткосрочно (сейчас):**
- Реализовать **Подход 5** (проверка и автоустановка)
- Создать `install_dependencies.sh` скрипт

**Долгосрочно (будущее):**
- Исследовать **Подход 4** (AppImage/DMG)
- Для macOS: создать `.app` bundle
- Для Linux: создать AppImage

---

## Связанные задачи

- [ ] Создать `install_dependencies.sh`
- [ ] Протестировать на чистой системе
- [ ] Документировать процесс установки
- [ ] Исследовать AppImage для Linux
- [ ] Исследовать DMG bundle для macOS

---

## Ссылки

- [AppImage Documentation](https://appimage.org/)
- [macOS App Bundles](https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFBundles/BundleTypes/BundleTypes.html)
- [VLC License (GPL)](https://www.videolan.org/legal.html)
