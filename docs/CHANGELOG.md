# Changelog

Все заметные изменения в проекте VLC Media Player with CEC Control будут задокументированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

---

## [Unreleased]

---

## [2025-11-28 13:56] - Реорганизация: Вся документация в DOCS/

### Changed
- **Структура проекта**: Документация перемещена в отдельную папку
  - `docs/` → `DOCS/` (для единообразия с RELIS/, BAK/)
  - Все .md файлы из корня → `DOCS/`
  - README.md остаётся в корне (для GitHub)
  
- **backup-end-of-day.sh**: Обновлены пути к файлам
  - Все .md файлы бэкапятся из `DOCS/`
  - Обновлён путь к `development_roadmap.md`
  
- **HANDOFF-NEXT-SESSION.md**: Обновлена документация
  - Новая структура проекта с `DOCS/`
  - Правила создания Summary файлов в `DOCS/`
  - Обновлены команды для workflow

### Technical
- Созданы бэкапы перед изменениями: `backup-end-of-day_V2`
- Структура упрощена: документация централизована
- Все пути проверены и обновлены

---

## [2025-11-28] - Рефакторинг: переход на универсальную терминологию

### Changed
- **playback-tracker.sh**: Полный рефакторинг библиотеки
  - Переименована функция `get_ser_file()` → `get_playback_file()`
  - Изменено расширение файлов прогресса: `.ser` → `.playback`
  - Обновлены все комментарии: "сериалы" → "видеофайлы" / "прогресс воспроизведения"
  - Обновлён header: `series-tracker.sh` → `playback-tracker.sh`
  - Помечены DEPRECATED функции `is_series_file()` и `get_episode_code()`

- **video-menu.sh**: Cleanup кода
  - Удалён отладочный вывод `DEBUG: Вычисленная ширина окна`
  
- **.gitignore**: Уже содержал поддержку обоих расширений (`.ser` и `.playback`)

### Migration
- Переименованы файлы прогресса: `.ser` → `.playback`, `.ser_RELIS` → `.playback_RELIS`
- Миграция прошла успешно, обратная совместимость сохранена

### Technical
- Все файлы проверены на корректность синтаксиса bash
- Созданы бэкапы: `playback-tracker_V1_251128_1246.bak`, `video-menu_V1_251128_1248.bak`

### Планируется
- Интеграция автосохранения прогресса в vlc-cec.sh
- Исправление переключения аудиодорожек (RED кнопка)
- Переработка функции громкости (YELLOW/BLUE кнопки)
- Система плейлистов
- Управление командами плеера из меню (без отдельного терминала)
- Решение проблемы с командой quit через nc

---

## [2025-11-28 13:22] - Релиз: Новые RELIS версии и cleanup

### Added
- **playback-tracker_RELIS.sh** - Первая релизная версия универсальной библиотеки отслеживания
  - Поддержка всех видеофайлов (не только сериалов)
  - Функции: `get_playback_file()`, `load_progress()`, `save_progress()`, `get_status_icon()`
  - Использует расширение `.playback` вместо `.ser`

### Changed
- **video-menu_RELIS.sh** - Обновлён для использования `playback-tracker.sh`
  - Интеграция с новой библиотекой вместо устаревшей `series-tracker.sh`
  - Поддержка отслеживания прогресса для всех видеофайлов
  - Очищен от DEBUG кода

### Removed
- **series-tracker.sh** - Удалён из проекта (сохранён в бэкапе)
  - Заменён на `playback-tracker.sh` с универсальной функциональностью
  - Legacy версия `series-tracker_RELIS.sh` оставлена для обратной совместимости

### Technical
- Созданы бэкапы перед релизом: `playback-tracker_V2`, `video-menu_V2`, `vlc-cec_V1`, `series-tracker_FINAL`
- Структура проекта упрощена: остались только актуальные рабочие файлы
- Все RELIS версии обновлены и синхронизированы

---

## [Unreleased] - Система бэкапов

### Changed
- **Система бэкапов**: Полная реорганизация
  - Новый единый формат: `filename_V#_YYMMDD_HHMM.bak`
  - Новая структура хранения: `BAK/YYMMDD/` для организации по датам
  - Автоматический бэкап RELIS файлов при завершении сессии
  - Бэкап Summary файлов в начале и конце дня
  - Архивирование старых бэкапов в `archive/old_backups_*/`
  - Добавлена документация в HANDOFF с ежедневным workflow
  - Создан скрипт `backup-end-of-day.sh` для автоматизации
  - Создано 10 бэкапов текущих файлов (4 рабочих .sh, 3 RELIS, 2 .md, 1 Summary)
  - Перемещено 14 старых файлов в архив

---

## [2025-11-27] - Универсальное отслеживание воспроизведения

### Added
- **playback-tracker.sh**: Новая библиотека для отслеживания прогресса всех видеофайлов (не только сериалов)
  - Убрана проверка `is_series_file` из функции `get_status_icon`
  - Поддержка отображения статусов для любых видеофайлов: AVI, MKV, MP4, MOV, WMV, FLV

### Changed
- **video-menu.sh**: Полная переработка отображения меню
  - Переход с `series-tracker.sh` на `playback-tracker.sh`
  - Исправлена структура `dialog --menu`: tag=имя файла, description=иконка+размер
  - Теперь hotkey работает правильно (первая буква файла подсвечивается красным)
  - Иконки статуса `[X]`, `[T]`, `[ ]` отображаются справа вместе с размером файла
  - Убрана проверка `is_series_file` при запуске видео - все файлы поддерживают сохранение позиции
  - Возврат курсора работает корректно:
    - При навигации вверх (`..`) - курсор на папку
    - После воспроизведения - курсор на видеофайл

- **vlc-cec.sh**: Добавлена поддержка старта с сохранённой позиции
  - Новый формат параметров: `[секунды] <видеофайл>`
  - Использование `:start-time=$START_TIME` для VLC при наличии сохранённой позиции
  - Обратная совместимость: работает и со старым форматом `<видеофайл>`

### Fixed
- Исправлена критическая ошибка: файлы не запускались при наличии `.ser` файла
  - Проблема: `vlc-cec.sh` не поддерживал второй параметр с секундами
  - Решение: Добавлена логика парсинга параметров из `vlc-cec_RELIS.sh`

---

## [2025-11-26] - Стабильная версия RELIS

### Added
- **vlc-cec_RELIS.sh** (Version 4): Релизная версия VLC плеера
  - Поддержка параметра `[секунды] <файл>` для старта с позиции
  - Исправлен возврат в меню через кнопку BACK
  - BACK эмулирует Ctrl+C через `kill -INT $$` для быстрой очистки
  - Принудительное завершение `cec-client` процессов через `pkill -9`

- **video-menu_RELIS.sh**: Релизная версия меню
  - Интеграция с `series-tracker.sh`
  - Отображение иконок статуса для сериалов
  - Автоматический возврат в меню после просмотра

- **series-tracker_RELIS.sh**: Библиотека отслеживания сериалов
  - Определение сериалов по паттерну `S##E##`
  - Сохранение/загрузка прогресса в `.ser` файлы
  - Иконки статуса: `[ ]` не просмотрено, `[T]` частично (1-98%), `[X]` просмотрено (99-100%)

### Changed
- Changelog V4: BACK кнопка отправляет `kill -INT $$` для эмуляции Ctrl+C
- Changelog V3: Добавлен `pkill -9 cec-client` при всех выходах
- Changelog V2: Исправлен баг с возвратом в меню при остановке VLC

---

## [2025-11-26 17:54] - Бэкапы перед релизом

### Backup
- **vlc-cec_backup_20251126_175404.sh**: Backup перед финальными изменениями
- **vlc-cec_backup_20251126_175438.sh**: Backup с экспериментальными функциями

---

## [2025-11-26 15:38] - Интеграция series-tracker

### Added
- **video-menu_before_integration.sh**: Версия меню перед интеграцией с series-tracker

### Changed
- Добавлена интеграция с библиотекой отслеживания сериалов
- Отображение иконок статуса в меню

---

## [2025-11-26 04:20] - Подготовка к series-tracker

### Backup
- **video-menu_before_series_tracker.sh**: Backup перед добавлением отслеживания сериалов

---

## [2025-11-26 03:22] - Финальная рабочая версия V2

### Added
- **video-menu_V2_final_working.sh**: Вторая финальная рабочая версия меню
- **vlc-cec_V4_final_working.sh**: Четвертая финальная рабочая версия VLC

### Fixed
- Исправлена работа меню
- Стабилизирована работа CEC управления

---

## [2025-11-26 02:33] - Исправление CEC, но проблемы с меню

### Changed
- **video-menu_menu_fixed_cec_3rd_broken.sh**: Исправлено CEC, но сломано меню
- **vlc-cec_menu_fixed_cec_3rd_broken.sh**: Работающий CEC с проблемами возврата в меню

---

## [2025-11-26 02:03] - Первые backup версии

### Backup
- **video-menu_bak_V1.sh**: Первый backup версии меню
- **vlc-cec_bak_V1.sh**: Первый backup версии VLC

---

## Текущие файлы проекта

### Активные (рабочие)
- `vlc-cec.sh` - VLC плеер с поддержкой CEC и сохранённых позиций
- `video-menu.sh` - Файловый менеджер с универсальным отслеживанием прогресса
- `playback-tracker.sh` - Библиотека отслеживания для всех видеофайлов
- `series-tracker.sh` - Библиотека отслеживания (legacy, для обратной совместимости)

### Релизные версии (_RELIS)
- `vlc-cec_RELIS.sh` - Стабильная версия VLC (Version 4)
- `video-menu_RELIS.sh` - Стабильная версия меню с сериалами
- `series-tracker_RELIS.sh` - Стабильная версия библиотеки сериалов

### Документация
- `HANDOFF-NEXT-SESSION.md` - Вводные данные для продолжения работы
- `Summary_251127_1745.md` - Технический отчёт по текущему состоянию проекта
- `CHANGELOG.md` - Этот файл

---

## Легенда обозначений

- **[Added]** - Новая функциональность
- **[Changed]** - Изменения в существующей функциональности
- **[Deprecated]** - Функциональность, которая скоро будет удалена
- **[Removed]** - Удалённая функциональность
- **[Fixed]** - Исправления багов
- **[Security]** - Исправления безопасности
- **[Backup]** - Backup версии для истории

---

## Технические детали

### Система версионирования файлов
- `filename.sh` - Текущая рабочая версия
- `filename_V#.sh` - Промежуточная версия (backup перед изменениями)
- `filename_RELIS.sh` - Финальный релиз (протестированная версия)
- `filename_backup_YYYYMMDD_HHMMSS.sh` - Автоматический backup с timestamp

### Формат .ser/.playback файлов
```
filename:seconds:total:percent:timestamp
```

**Пример:**
```
video.avi:2673:2700:99:1732567890
```

### Иконки статуса
- `[ ]` - Не просмотрено (0%)
- `[T]` - Частично просмотрено (1-98%)
- `[X]` - Просмотрено полностью (99-100%)

---

**Последнее обновление:** 28.11.2025, 13:22
